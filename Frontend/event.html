<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Management</title>
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <!-- Custom styles -->
  <style>
    .event-container {
      margin-top: 50px;
    }
    .form-container {
      margin-top: 20px;
    }
    .btn-action {
      margin-right: 10px;
    }
  </style>
</head>
<body>

<div class="container event-container">
  <h2>Event Management</h2>

  <!-- Event List -->
  <div class="card mt-4">
    <div class="card-header">
      Event List
    </div>
    <div class="card-body">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Date</th>
            <th>Location</th>
            <th>Organizer</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="event-table-body">
          <!-- Event items will be dynamically added here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Create / Update Form -->
  <div class="card form-container mt-4">
    <div class="card-header">
      Create / Update Event
    </div>
    <div class="card-body">
      <form id="event-form">
        <input type="hidden" id="eventId">
        <div class="form-group">
          <label for="title">Title</label>
          <input type="text" class="form-control" id="title" placeholder="Enter event title" required>
        </div>
        <div class="form-group">
          <label for="description">Description</label>
          <textarea class="form-control" id="description" rows="3" placeholder="Enter event description" required></textarea>
        </div>
        <div class="form-group">
          <label for="date">Date</label>
          <input type="date" class="form-control" id="date" required>
        </div>
        <div class="form-group">
          <label for="location">Location</label>
          <input type="text" class="form-control" id="location" placeholder="Enter event location" required>
        </div>
        <div class="form-group">
          <label for="organizer">Organizer</label>
          <input type="text" class="form-control" id="organizer" placeholder="Enter event organizer" required>
        </div>
        <button type="submit" class="btn btn-primary btn-action" id="submit-btn">Save Event</button>
        <button type="button" class="btn btn-secondary btn-action" id="cancel-btn" onclick="clearForm()">Cancel</button>
      </form>
    </div>
  </div>

</div>

<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<!-- Custom script for event management -->
<script>
  // Function to fetch and display all events
  function fetchEvents() {
    fetch('http://localhost:4000/api/v1/events')
      .then(response => response.json())
      .then(data => {
        const eventTableBody = document.getElementById('event-table-body');
        eventTableBody.innerHTML = '';
        data.data.forEach(event => {
          const row = `
            <tr>
              <td>${event.title}</td>
              <td>${event.description}</td>
              <td>${new Date(event.date).toLocaleDateString()}</td>
              <td>${event.location}</td>
              <td>${event.organizer}</td>
              <td>
                <button class="btn btn-sm btn-info" onclick="editEvent('${event._id}')">Edit</button>
                <button class="btn btn-sm btn-danger" onclick="deleteEvent('${event._id}')">Delete</button>
              </td>
            </tr>
          `;
          eventTableBody.innerHTML += row;
        });
      })
      .catch(error => console.error('Error fetching events:', error));
  }

  // Function to create or update event
  function saveEvent(eventId) {
    const title = document.getElementById('title').value;
    const description = document.getElementById('description').value;
    const date = document.getElementById('date').value;
    const location = document.getElementById('location').value;
    const organizer = document.getElementById('organizer').value;

    const data = {
      title,
      description,
      date,
      location,
      organizer
    };

    let url = 'http://localhost:4000/api/v1/events';
    let method = 'POST';

    if (eventId) {
      url += `/${eventId}`;
      method = 'PUT';
    }

    fetch(url, {
      method: method,
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    })
    .then(response => response.json())
    .then(() => {
      fetchEvents(); // Refresh event list
      clearForm();
    })
    .catch(error => console.error('Error saving event:', error));
  }

  // Function to fetch event details for editing
  function editEvent(eventId) {
    fetch(`http://localhost:4000/api/v1/events/${eventId}`)
      .then(response => response.json())
      .then(data => {
        const event = data.data;
        document.getElementById('eventId').value = event._id;
        document.getElementById('title').value = event.title;
        document.getElementById('description').value = event.description;
        document.getElementById('date').value = event.date.slice(0, 10); // Format date for input
        document.getElementById('location').value = event.location;
        document.getElementById('organizer').value = event.organizer;
        document.getElementById('submit-btn').textContent = 'Update Event';
      })
      .catch(error => console.error('Error fetching event details:', error));
  }

  // Function to delete an event
  function deleteEvent(eventId) {
    if (confirm('Are you sure you want to delete this event?')) {
      fetch(`http://localhost:4000/api/v1/events/${eventId}`, {
        method: 'DELETE',
      })
      .then(() => {
        fetchEvents(); // Refresh event list
      })
      .catch(error => console.error('Error deleting event:', error));
    }
  }

  // Function to clear the form fields
  function clearForm() {
    document.getElementById('eventId').value = '';
    document.getElementById('title').value = '';
    document.getElementById('description').value = '';
    document.getElementById('date').value = '';
    document.getElementById('location').value = '';
    document.getElementById('organizer').value = '';
    document.getElementById('submit-btn').textContent = 'Save Event';
  }

  // Initial fetch of events when page loads
  document.addEventListener('DOMContentLoaded', () => {
    fetchEvents();
  });

  // Prevent default form submission behavior
  document.getElementById('event-form').addEventListener('submit', function(event) {
    event.preventDefault();
    const eventId = document.getElementById('eventId').value;
    saveEvent(eventId);
  });

</script>

</body>
</html>
